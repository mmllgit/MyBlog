---
title: 从浏览器输入url发生了什么？
excerpt: 从浏览器输入url发生了什么？
image: head.jpg
date: "2022-9-4"
isFeatured: true
---

## 从浏览器输入url发生了什么？

### 首先了解一个url

https://www.baidu.com:443

- url：统一资源定位符

+ https：传输协议（http和TCP之间加了一层TSL或则SSL的安全层）

+ www：服务器

+ baidu.com：域名

+ 443：端口号（http默认端口号80，https默认端口号443）

### 在浏览器输入url按下回车后

1. 合成URL
2. DNS域名解析
3. 建立TCP连接，三次招手
4. 发送HTTP请求，服务器处理请求，返回响应结果
5. 关闭TCP连接，四次挥手
6. 浏览器渲染

### 合成URL

用户输入URL，浏览器会根据用户输入的信息判断是搜索还是网址，有如下两种情况：

+ 如果是搜索内容，就将搜索内容+默认搜索引擎合成新的URL
+ 如果用户输入符合URL规则，浏览器就会根据URL协议，在这段内容上加上协议合成合法的URL

### DNS域名解析

DNS服务器就是将IP地址对应上网站名称的服务器，DNS服务器时高可用、高并发和分布式的，分为三种：

+ 根DNS服务器：返回顶级域DNS服务器的IP地址
+ 顶级域DNS服务器：返回权威DNS服务器的IP地址
+ 权威DNS服务器：返回相应主机的IP地址

### 建立TCP连接

1. 首先判断是否是https，如果是，则服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据
2. 进行三次握手，建立TCP连接
   1. 第一次握手：建立连接。客户端发送连接请求报文段，客户端进入SYN_SEND状态，等待服务器的确认；
   2. 第二次握手：服务器收到SYN报文段。服务端将信息放到一个报文段中，发送给客户端，此时服务器进入SYN_RECV状态；
   3. 第三次握手：客户端收到服务器的SYN+ACK报文段。
3. SSL握手过程
   1. 第一阶段：建立安全能力 包括协议版本 会话Id 密码构件 压缩方法和初始随机数
   2. 第二阶段：服务器发送证书 密钥交换数据和证书请求，最后发送请求-相应阶段的结束信号
   3. 第三阶段：如果有证书请求客户端发送此证书 之后客户端发送密钥交换数据 也可以发送证书验证消息
   4. 第四阶段：变更密码构件和结束握手协议

### 发送http请求，服务器处理请求，返回响应结果

TCP连接建立后，浏览器就可以利用HTTP/HTTPS协议向服务器发送请求了。

### 关闭TCP连接

1. 第一次挥手：主机1向主机2发送一个FIN报文段，主机1进入FIN_WAIT_1状态，表示没有数据发送给主机2了
2. 第二次挥手：主机2收到主机1发送的FIN报文段，主机1回一个ACK报文段，主机1进入FIN_WAIT_2状态，告诉主机1，我同意你的关闭请求了
3. 第三次挥手：主机2向主机1发送FIN报文段，请求关闭连接，同时主机2进入LAST_ACK状态
4. 第四次挥手：主机1收到主机2发送的FIN报文段，向主机2发送ACK报文段，然后主机1进入TIME_WAIT状态；主机2收到主机1的ACK报文段以后，就关闭连接；此时，主机1等待2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，主机1也可以关闭连接了。

### 浏览器渲染

1. 渲染进程将HTML内容转换为能够读懂的DOM树结构
2. 渲染引擎将CSS样式表转化为浏览器可以理解的styleSheets，计算出DOM节点的样式
3. 创建布局树，并计算元素的布局信息
4. 对布局树进行分层，并生成分层树
5. 为每个图层生成会绘制列表，并将其提交到合成线程。合成线程将图层分图块，并栅格化将图块转换成位图。
6. 合成线程发送绘制图块命令给浏览器进程。浏览器进程根据指令生成页面，并显示到显示屏上。