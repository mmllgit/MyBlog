---
title: url到页面解析
excerpt: url到页面解析
image: head.jpg
date: "2022-9-4"
isFeatured: false
---

## 从浏览器输入 url 发生了什么？

### 首先了解一个 url

https://www.baidu.com:443

- url：统一资源定位符

* https：传输协议（http 和 TCP 之间加了一层 TSL 或则 SSL 的安全层）

* www：服务器

* baidu.com：域名

* 443：端口号（http 默认端口号 80，https 默认端口号 443）

### 在浏览器输入 url 按下回车后

1. 合成 URL
2. DNS 域名解析
3. 建立 TCP 连接，三次招手
4. 发送 HTTP 请求，服务器处理请求，返回响应结果
5. 关闭 TCP 连接，四次挥手
6. 浏览器渲染

### 合成 URL

用户输入 URL，浏览器会根据用户输入的信息判断是搜索还是网址，有如下两种情况：

- 如果是搜索内容，就将搜索内容+默认搜索引擎合成新的 URL
- 如果用户输入符合 URL 规则，浏览器就会根据 URL 协议，在这段内容上加上协议合成合法的 URL

### DNS 域名解析

DNS 服务器就是将 IP 地址对应上网站名称的服务器，DNS 服务器时高可用、高并发和分布式的，分为三种：

- 根 DNS 服务器：返回顶级域 DNS 服务器的 IP 地址
- 顶级域 DNS 服务器：返回权威 DNS 服务器的 IP 地址
- 权威 DNS 服务器：返回相应主机的 IP 地址

### 建立 TCP 连接

1. 首先判断是否是 https，如果是，则服务端和客户端的信息传输都会通过 TLS 进行加密，所以传输的数据都是加密后的数据
2. 进行三次握手，建立 TCP 连接
   1. 第一次握手：建立连接。客户端发送连接请求报文段，客户端进入 SYN_SEND 状态，等待服务器的确认；
   2. 第二次握手：服务器收到 SYN 报文段。服务端将信息放到一个报文段中，发送给客户端，此时服务器进入 SYN_RECV 状态；
   3. 第三次握手：客户端收到服务器的 SYN+ACK 报文段。
   4. 确认双方
3. SSL 握手过程
   1. 第一阶段：建立安全能力 包括协议版本 会话 Id 密码构件 压缩方法和初始随机数
   2. 第二阶段：服务器发送证书 密钥交换数据和证书请求，最后发送请求-相应阶段的结束信号
   3. 第三阶段：如果有证书请求客户端发送此证书 之后客户端发送密钥交换数据 也可以发送证书验证消息
   4. 第四阶段：变更密码构件和结束握手协议

### 发送 http 请求，服务器处理请求，返回响应结果

TCP 连接建立后，浏览器就可以利用 HTTP/HTTPS 协议向服务器发送请求了。

### 关闭 TCP 连接

1. 第一次挥手：主机 1 向主机 2 发送一个 FIN 报文段，主机 1 进入 FIN_WAIT_1 状态，表示没有数据发送给主机 2 了
2. 第二次挥手：主机 2 收到主机 1 发送的 FIN 报文段，主机 1 回一个 ACK 报文段，主机 1 进入 FIN_WAIT_2 状态，告诉主机 1，我同意你的关闭请求了
3. 第三次挥手：主机 2 向主机 1 发送 FIN 报文段，请求关闭连接，同时主机 2 进入 LAST_ACK 状态
4. 第四次挥手：主机 1 收到主机 2 发送的 FIN 报文段，向主机 2 发送 ACK 报文段，然后主机 1 进入 TIME_WAIT 状态；主机 2 收到主机 1 的 ACK 报文段以后，就关闭连接；此时，主机 1 等待 2MSL 后依然没有收到回复，则证明 Server 端已正常关闭，那好，主机 1 也可以关闭连接了。

### 浏览器渲染

1. 渲染进程将 HTML 内容转换为能够读懂的 DOM 树结构
2. 渲染引擎将 CSS 样式表转化为浏览器可以理解的 styleSheets，计算出 DOM 节点的样式
3. 创建布局树，并计算元素的布局信息
4. 对布局树进行分层，并生成分层树
5. 为每个图层生成会绘制列表，并将其提交到合成线程。合成线程将图层分图块，并栅格化将图块转换成位图。
6. 合成线程发送绘制图块命令给浏览器进程。浏览器进程根据指令生成页面，并显示到显示屏上。
